# 订阅功能配置说明

## 问题原因

订阅功能不工作的原因有两个：

1. **API 路由配置错误**：`app/api/newsletter/route.ts` 中使用了 `export const dynamic = 'force-static'`，这会导致 API 在构建时静态生成，无法处理动态的订阅请求。

2. **缺少环境变量配置**：项目配置使用 `buttondown` 作为邮件服务提供商，但没有配置必需的 `BUTTONDOWN_API_KEY`。

## 已完成的修复

### 1. 修改 API 路由配置

已将 `app/api/newsletter/route.ts` 中的：
```typescript
export const dynamic = 'force-static'
```

改为：
```typescript
export const dynamic = 'force-dynamic'
```

### 2. 创建环境变量文件

已创建 `.env.local` 文件模板。

## 配置步骤

### 选项 1：使用 Buttondown（当前配置）

1. 访问 [Buttondown](https://buttondown.email/) 并注册账号
2. 在设置页面获取 API Key：https://buttondown.email/settings
3. 编辑 `.env.local` 文件，填入你的 API Key：
   ```bash
   BUTTONDOWN_API_KEY=your_api_key_here
   ```
4. 重启开发服务器

### 选项 2：不使用订阅功能

如果不需要订阅功能，可以在 `data/siteMetadata.js` 中禁用：

```javascript
newsletter: {
    provider: '', // 设置为空字符串以禁用
},
```

### 选项 3：使用其他邮件服务

可以选择其他服务提供商：

#### Mailchimp
```javascript
// data/siteMetadata.js
newsletter: {
    provider: 'mailchimp',
},
```

```bash
# .env.local
MAILCHIMP_API_KEY=your_key
MAILCHIMP_API_SERVER=us1
MAILCHIMP_AUDIENCE_ID=your_audience_id
```

#### ConvertKit
```javascript
// data/siteMetadata.js
newsletter: {
    provider: 'convertkit',
},
```

```bash
# .env.local
CONVERTKIT_API_KEY=your_key
CONVERTKIT_FORM_ID=your_form_id
```

## 测试

完成配置后：
1. 重启开发服务器：`npm run dev` 或 `yarn dev`
2. 在首页找到订阅表单
3. 输入有效的邮箱地址进行测试
4. 检查对应的邮件服务后台是否收到订阅

## 注意事项

- `.env.local` 文件已被 git 忽略，不会被提交到仓库
- 部署到生产环境时，需要在 Vercel/Netlify 等平台的环境变量中配置相应的 API Key
- 确保 API Key 保密，不要提交到代码仓库

