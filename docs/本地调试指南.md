# 本地调试指南

## 项目概述

这是一个基于 Next.js 15 的博客项目，使用 TypeScript、Tailwind CSS 4.0 和 Contentlayer2 构建。项目支持 MDX 内容管理、多主题切换、代码高亮、数学公式渲染等功能。

## 环境要求

- **Node.js**: 建议使用 Node.js 18.x 或更高版本
- **包管理器**: Yarn 3.6.1（项目已配置）
- **操作系统**: macOS、Linux 或 Windows（需要 WSL）

### 检查环境

```bash
# 检查 Node.js 版本
node --version

# 检查 Yarn 版本（如果已安装）
yarn --version
```

## 安装步骤

### 1. 克隆项目（如果尚未克隆）

```bash
git clone <your-repo-url>
cd wersling-blog
```

### 2. 安装依赖

```bash
yarn install
```

**注意**: 如果使用 Windows 系统，可能需要先设置环境变量：

```powershell
$env:PWD = $(Get-Location).Path
```

### 3. 配置环境变量（可选）

如果需要使用以下功能，需要配置相应的环境变量：

- **Analytics（分析）**: 创建 `.env.local` 文件，添加 `NEXT_UMAMI_ID`
- **评论系统（Giscus）**: 添加以下变量：
  - `NEXT_PUBLIC_GISCUS_REPO`
  - `NEXT_PUBLIC_GISCUS_REPOSITORY_ID`
  - `NEXT_PUBLIC_GISCUS_CATEGORY`
  - `NEXT_PUBLIC_GISCUS_CATEGORY_ID`
- **Newsletter（邮件订阅）**: 根据选择的提供商配置相应变量

`.env.local` 示例：

```env
# Analytics
NEXT_UMAMI_ID=your-umami-id

# Giscus Comments
NEXT_PUBLIC_GISCUS_REPO=your-username/your-repo
NEXT_PUBLIC_GISCUS_REPOSITORY_ID=your-repo-id
NEXT_PUBLIC_GISCUS_CATEGORY=General
NEXT_PUBLIC_GISCUS_CATEGORY_ID=your-category-id
```

## 启动开发服务器

### 基本启动

```bash
yarn dev
```

或者使用：

```bash
yarn start
```

开发服务器将在 `http://localhost:3000` 启动。

### 开发模式说明

- **热重载**: 修改代码或内容后，页面会自动更新
- **Contentlayer**: 修改 `data/blog` 目录下的 MDX 文件后，会自动重新生成内容
- **TypeScript**: 类型检查在开发时实时进行

## 常用命令

### 开发相关

```bash
# 启动开发服务器
yarn dev

# 构建生产版本
yarn build

# 启动生产服务器（需要先执行 build）
yarn serve

# 代码检查并自动修复
yarn lint
```

### 分析相关

```bash
# 分析打包大小
yarn analyze
```

## 项目结构说明

```
wersling-blog/
├── app/                    # Next.js App Router 目录
│   ├── blog/              # 博客路由
│   ├── api/               # API 路由
│   └── layout.tsx         # 根布局
├── components/             # React 组件
├── data/                   # 内容数据
│   ├── authors/           # 作者信息（MDX）
│   ├── blog/              # 博客文章（MDX）
│   ├── siteMetadata.js    # 网站元数据配置
│   └── projectsData.ts    # 项目数据
├── layouts/                # 布局组件
├── css/                    # 样式文件
├── public/                 # 静态资源
├── contentlayer.config.ts  # Contentlayer 配置
├── next.config.js          # Next.js 配置
└── tsconfig.json           # TypeScript 配置
```

## 调试技巧

### 1. 查看 Contentlayer 生成的内容

Contentlayer 会在开发时自动生成内容类型定义。生成的文件位于：

- `.contentlayer/generated/` 目录（已添加到 .gitignore）

如果需要查看生成的内容，可以：

```bash
# 清理并重新生成
rm -rf .contentlayer
yarn dev
```

### 2. 调试 TypeScript 错误

```bash
# 检查 TypeScript 类型错误
npx tsc --noEmit
```

### 3. 调试构建问题

```bash
# 清理构建缓存
rm -rf .next
rm -rf .contentlayer
yarn build
```

### 4. 查看网络请求

开发时打开浏览器开发者工具（F12），在 Network 标签页查看 API 请求和资源加载情况。

### 5. 调试 MDX 内容

- 检查 `data/blog/*.mdx` 文件的 frontmatter 格式是否正确
- 确保 frontmatter 中的必填字段（title, date）存在
- 查看终端错误信息，Contentlayer 会显示具体的错误位置

## 常见问题排查

### 1. 端口 3000 已被占用

**解决方案**:

```bash
# macOS/Linux
lsof -ti:3000 | xargs kill -9

# 或使用其他端口
PORT=3001 yarn dev
```

### 2. Contentlayer 内容未更新

**解决方案**:

```bash
# 清理 Contentlayer 缓存
rm -rf .contentlayer
yarn dev
```

### 3. 类型错误

**解决方案**:

```bash
# 确保 Contentlayer 已生成类型定义
yarn dev

# 如果仍有问题，尝试重新安装依赖
rm -rf node_modules .yarn
yarn install
```

### 4. Tailwind CSS 样式未生效

**解决方案**:

- 检查 `css/tailwind.css` 是否正确导入
- 确认 `tailwind.config.js` 配置正确
- 重启开发服务器

### 5. 图片无法显示

**解决方案**:

- 检查图片路径是否正确（相对于 `public` 目录）
- 确认 `next.config.js` 中的图片配置
- 使用 `next/image` 组件时，确保图片域名已添加到配置中

### 6. Windows 环境变量问题

**解决方案**:

在 PowerShell 中设置：

```powershell
$env:PWD = $(Get-Location).Path
$env:INIT_CWD = $(Get-Location).Path
yarn dev
```

或使用 Git Bash：

```bash
export PWD=$(pwd)
export INIT_CWD=$(pwd)
yarn dev
```

## 修改内容

### 添加博客文章

1. 在 `data/blog/` 目录下创建新的 `.mdx` 文件
2. 添加 frontmatter：

```markdown
---
title: '文章标题'
date: '2024-01-01'
tags: ['tag1', 'tag2']
draft: false
summary: '文章摘要'
authors: ['default']
layout: PostLayout
---

文章内容...
```

3. 保存文件后，开发服务器会自动重新生成内容

### 修改网站配置

编辑 `data/siteMetadata.js` 文件：

- `title`: 网站标题
- `author`: 默认作者
- `description`: 网站描述
- `siteUrl`: 网站 URL
- `socialBanner`: 社交媒体卡片图片
- 其他社交媒体链接

### 修改导航链接

编辑 `data/headerNavLinks.ts` 文件。

## 性能优化

### 1. 使用生产模式测试

```bash
yarn build
yarn serve
```

### 2. 分析打包大小

```bash
yarn analyze
```

会生成一个可视化的打包分析报告。

### 3. 检查 Lighthouse 分数

在浏览器中打开 `http://localhost:3000`，使用 Chrome DevTools 的 Lighthouse 功能进行性能分析。

## 开发最佳实践

1. **代码格式**: 项目已配置 Prettier 和 ESLint，保存时会自动格式化
2. **Git Hooks**: 项目使用 Husky，提交前会自动运行 lint-staged
3. **类型安全**: 充分利用 TypeScript 的类型检查，避免运行时错误
4. **内容管理**: 使用 Contentlayer 管理 MDX 内容，确保类型安全

## 获取帮助

- 查看项目 README.md 获取更多信息
- 检查 Next.js 文档: https://nextjs.org/docs
- 查看 Contentlayer 文档: https://www.contentlayer.dev/docs
- 查看项目 Issues: https://github.com/timlrx/tailwind-nextjs-starter-blog/issues

## 注意事项

1. **首次启动**: 首次运行 `yarn dev` 时，Contentlayer 需要生成类型定义，可能需要一些时间
2. **文件监听**: 确保文件系统支持文件监听（某些虚拟机或网络文件系统可能不支持）
3. **内存使用**: 大型项目可能需要更多内存，如果遇到内存错误，可以增加 Node.js 内存限制：

```bash
NODE_OPTIONS="--max-old-space-size=4096" yarn dev
```

4. **Windows 路径**: Windows 系统中路径分隔符使用反斜杠，某些脚本可能需要调整

